

<template>
    <container class="flex flex-col max-w-1240 mx-auto px-56 py-64">
        <h1 class="text-Black font-golos text-5xl font-bold leading-14">
            –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–æ–π
        </h1>
        <PeriodSelector @select-period="handleChangePeriod"/>

        <div class="flex gap-2 mt-8">
            <h5 class="text-Black font-golos text-2xl font-bold leading-8">
                –î–∏–Ω–∞–º–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏¬†–æ—Ç–∑—ã–≤–æ–≤ –∑–∞ 30¬†–¥–Ω–µ–π
            </h5>
            <Tooltip class="align-top" :content="'–ö–∞–∫–æ–π —Ç–æ —Ç–µ–∫—Å—Ç'" />
        </div>

        <div class="container-max pt-8 px-4 pb-12 rounded-md border border-dividers-borders-disabled-state mt-4">


            <div class="flex gap-10">
                <div class="flex gap-2">
                    <div class="text-Black font-golos text-4xl font-bold leading-10">1720</div>
                    <div class="text-Black font-Inter text-sm font-normal leading-4 py-1 text-wrap">
                        –∑–∞–ø—Ä–æ—Å–æ–≤ <br /> –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
                    </div>
                </div>

                <div class="flex gap-2">
                    <div class="text-Green font-golos text-4xl font-bold leading-10">142</div>
                    <div class="text-Black font-Inter text-sm font-normal leading-4 py-1 text-wrap">
                        –ø—Ä–∏—Ä–æ—Å—Ç <br /> –æ—Ç–∑—ã–≤–æ–≤
                    </div>
                </div>

                <div class="flex gap-2">
                    <div class="text-Orange font-golos text-4xl font-bold leading-10">22</div>
                    <div class="text-Black font-Inter text-sm font-normal leading-4 py-1 text-wrap">
                        –Ω–µ–≥–∞—Ç–∏–≤–∞ <br />–ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ
                    </div>
                </div>

                <div class="flex gap-2">
                    <div class="text-Black font-golos text-4xl font-bold leading-10">4.5</div>
                    <div class="text-Black font-Inter text-sm font-normal leading-4 py-1 text-wrap">
                        <vue3-star-ratings v-model="rating" starColor="#FFEB3B" starSize="14" inactiveColor="#d2d2d2" />
                        629 –æ—Ç–∑—ã–≤–æ–≤
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-5 gap-4 items-top mt-6">
                <div class="max-w-185 text-wrap text-Black font-inter font-bold">
                    –ü–ª–æ—â–∞–¥–∫–∏<br /> –∏ –∏—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                    <Tooltip class="align-center" :content="'–í—Å–ø–ª—ã–≤–∞—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–æ¬†–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å'" />
                </div>

                <div>
                    <div class="text-Black font-inter font-bold">–†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã</div>
                    <div class="flex gap-6">
                        <div>1 —è–Ω–≤</div>
                        <div>31 —Ñ–µ–≤</div>
                    </div>
                </div>



                <div class="max-w-185 text-wrap text-Black font-inter font-bold">
                    –ü—Ä–∏—Ä–æ—Å—Ç –æ—Ç–∑—ã–≤–æ–≤<br /> –∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
                </div>

                <div class="max-w-185 text-wrap text-Black font-inter font-bold">
                    –î–æ–ª—è –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö<br /> –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
                </div>

                <div class="flex max-w-185 text-wrap text-Black font-inter font-bold justify-center">
                    –ú–µ—Å—Ç–æ<br /> –≤ –≥–æ—Ä–æ–¥–µ
                </div>
            </div>

            <div class="mt-6">

                <ul class="platform-list">
                    <li v-for="platformItem in platformPeriod" :key="platformItem.id" class="grid grid-cols-5 gap-2">
                        <div class="col-span-1">
                            <div class="flex gap-4">
                                <ToggleBtn :is-checked="platformItem.status" @change-status="handleChangeStatus(platformItem.id)" />

                                <PlatformItem :platform-id="platformItem.id" />
                            </div>
                        </div>

                        <div class="col">
                            <div class="flex gap-6">
                                <div class="flex flex-col items-center">
                                    <span class="px-2 py-0 rounded-md bg-[#FCF0EA] text-Black font-inter leading-6">
                                        {{ platformItem.Rating.start }}
                                    </span>
                                    <span class="text-gray-500 font-Inter text-base font-normal leading-6">
                                        {{ platformItem.reviews.start }}
                                    </span>
                                </div>

                                <div class="flex flex-col items-center">
                                    <span class="px-2 py-0 rounded-md bg-[#E9F6F0] text-Black font-inter leading-6">
                                        {{ platformItem.Rating.end }}
                                    </span>
                                    <span class="text-gray-500 font-Inter text-base font-normal leading-6">
                                        {{ platformItem.reviews.end }}
                                    </span>
                                </div>
                            </div>
                        </div>



                        <div class="col">
                            <div class="flex justify-start">
                                <div class="flex flex-col items-center">
                                <span class="px-2 py-0 rounded-md text-Green font-inter leading-6 font-bold">
                                +{{ platformItem.IncreaseRating.rating }}
                                </span>
                                <span class="text-gray-500 font-Inter text-base font-bold leading-6">
                                +{{ platformItem.IncreaseRating.reviews }}
                                </span>
                            </div>
                            </div>
                        </div>

                        <div class="col">
                            <div class="flex gap-5">
                                <span class="px-2 py-0 rounded-md bg-[#E9F6F0] text-Black font-inter leading-6 h-6">
                                    {{ platformItem.ShareNegativeToday.percent }}%
                                </span>

                                <span class="text-Orange font-Inter text-base font-normal leading-6">
                                    {{ platformItem.ShareNegativeToday.reviews }} –æ—Ç–∑—ã–≤–æ–≤
                                </span>
                                <span> –∏–∑ {{ platformItem.ShareNegativeToday.total }}</span>
                            </div>
                        </div>

                        <div class="col">
                            <div class="flex gap-2 justify-center">
                                <span>
                                    {{ platformItem.PlaceCity.place }} –∏–∑ {{ platformItem.PlaceCity.total }}
                                </span>
                                <div v-show="platformItem.PlaceCity.isUp"
                                    class="text-Green font-Inter text-base font-normal leading-6">ü†ï
                                </div>

                                <div v-show="platformItem.PlaceCity.isDown"
                                    class="text-Orange font-Inter text-base font-normal leading-6">ü†ì
                                </div>

                            </div>
                        </div>


                    </li>
                </ul>


            </div>
        </div>

    </container>
</template>
  
<script setup lang="ts">
import { ref, onMounted } from 'vue';

import PeriodSelector from '~/components/PeriodSelector.vue'
import Tooltip from '~/components/TooltipBtn.vue'
import vue3starRatings from "vue3-star-ratings";
import ToggleBtn from '~/components/ToggleBtn.vue'
import PlatformItem from '~/components/PlatformItem.vue';
const rating = ref(4.5)


interface Platform {
    id: number;
    status: boolean;
    Rating: {
        start: number,
        end: number
    };
    reviews: {
        start: number,
        end: number
    };
    IncreaseRating: {
        rating: number,
        reviews: number
    };
    ShareNegativeToday: {
        percent: number,
        reviews: number,
        total: number
    };
    PlaceCity: {
        place: number,
        total: number,
        isUp: boolean,
        isDown: boolean
    };
}
const platformPeriod = ref<Array<Platform>>([]);

    // –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–µ—Ä–∏–æ–¥–∞ - –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∑–∞ –Ω–µ–¥–µ–ª—é –∏ –º–µ—Å—è—Ü
    const receivedDays = ref();
    
const handleChangePeriod = (days:number) => {
    receivedDays.value = days
    console.log('change period ', receivedDays.value);
    // –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞
    fetchDataBasedOnDays(receivedDays.value)
   
};

const fetchDataBasedOnDays = async (days:number) => {
    if (days === 7) {
        await fetchDataByPeriod('/api/week');
    } 

    if(days === 30){
        await fetchDataByPeriod('/api/month');
    }
    
    else {
        // –î–æ–±–∞–≤—å –¥—Ä—É–≥–∏–µ —É—Å–ª–æ–≤–∏—è, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
        console.log('No endpoint for the given number of days.');
    }

 
}

const fetchDataByPeriod = async (endpoint:string) => {
    try {
        const response = await fetch(endpoint);
        const responseData = await response.json();
        platformPeriod.value = responseData.data
    } catch (error) {
        console.error('Error fetching data:', error);
    }
};

// –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –¥–Ω–µ–π
const fetchData = async () => {
    try {
        const response = await fetch('/api/month');
        const responseData = await response.json();
        platformPeriod.value = responseData.data
    } catch (error) {
        console.error('Error fetching data:', error);
    }
};


// –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –±—ç–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ 
const handleChangeStatus = (platformID:number) => {
    console.log('change status', platformID)
    submitChangeStatus(platformID)
    
}

const submitChangeStatus = async (platformID:number) => {
    const { data: responseData } = await useFetch('/api/change', {
        method: 'post',
        body: { 
         id: platformID
        }
    })

    console.log(responseData.value)
}

onMounted(() => {
    fetchData();
});
</script>
  
<style lang="scss">
.container-max {
    max-width: 1128px;
}
.platform-list {
    li {
        &:not(:last-child){
            margin-bottom: 16px;
        }
    }
}
</style>
  